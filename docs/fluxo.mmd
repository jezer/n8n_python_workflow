graph TD
    subgraph "üìÅ Pipeline de Pr√©-processamento"
        A["üìÇ Ingest√£o de Arquivos"] -->|"IA: Usar OCR (Tesseract+LayoutLM) com p√≥s-processamento por LLM para corre√ß√£o (ex: GPT-4 para valida√ß√£o contextual)"| B["üìë Segmenta√ß√£o de Texto"]
        
        B -->|"IA: Classificador bin√°rio (BERTimbau) + fallback para regras heur√≠sticas (ex: padr√µes de rodap√©). Logar decis√µes para auditoria."| C["üßπ Limpeza e Normaliza√ß√£o"]
        
        C -->|"IA: Chunking sem√¢ntico com sliding window (512 tokens) + overlap controlado (15%). Usar embeddings do texto para determinar pontos de corte naturais."| D["üìè Chunking Inteligente"]
        
        D -->|"IA: DeBERTa-v3 fine-tuned com threshold de confian√ßa (0.7). Chunks abaixo do threshold receber tag 'REVISAR'"| E["üè∑Ô∏è Classifica√ß√£o e Tagging"]
    end

    subgraph "üóÑÔ∏è Constru√ß√£o do Conhecimento"
        E -->|"IA: Extrair triplas (sujeito-predicado-objeto) com REBEL, normalizar entidades (ex: Python3‚ÜíPython 3). Validar com valida√ß√£o cruzada."| F["üìä Grafo de Conhecimento"]
        
        F -->|"IA: Few-shot prompting com exemplos validados por especialista. Incluir chain-of-thought e verifica√ß√µes de factualidade."| G["‚ùì Gera√ß√£o de QA (Few-shot)"]
        
        G -->|"IA: Fine-tune de embeddings (instructor-xl) com triplet loss. Monitorar loss em dataset de valida√ß√£o."| H["üî¢ Embeddings Especializados"]
        
        H -->|"IA: Indexa√ß√£o FAISS (HNSW) com monitoramento cont√≠nuo (recall@k). Versionar √≠ndices."| I["üìå Indexa√ß√£o Vetorial"]
        
        I -->|"IA: NER customizado (spaCy + transformer) + linking para entidades do grafo. Logar metadados gerados."| J["üè∑Ô∏è Metadados Enriquecidos"]
    end

    subgraph "üõ†Ô∏è Sistema RAG"
        K["üîç Hybrid Retriever"] -->|"IA: Weighted score (0.6 dense + 0.4 sparse). Cache de embeddings (TTL=24h). Fallback para BM25 se erro."| L["‚öñÔ∏è Reranking (Cross-Encoder)"]
        
        L -->|"IA: Dynamic few-shot selection (top-3 exemplos similares por embedding). Fallback para exemplos gen√©ricos se similaridade <0.65."| M["üß† LLM com RAG"]
    end

    subgraph "üìà Ciclo de Melhoria"
        M -->|"IA: Avalia√ß√£o autom√°tica (ROUGE, BERTScore, precis√£o de cita√ß√µes) + LLM-as-a-judge (GPT-4 com crit√©rios expl√≠citos)."| N["üìù Avalia√ß√£o Cont√≠nua"]
        
        N -->|"IA: Hard negative mining baseado em erros. Fine-tuning progressivo com early stopping."| O["üîß Retriever Adaptativo"]
        
        O -->|"IA: Atualiza√ß√£o d elta de embeddings (semanal). Versionamento com rollback autom√°tico se recall cair >5%."| P["üîÑ Atualiza√ß√£o Incremental"]
        
        N -->|"IA: Teste A/B com STaR framework. Logar todas as varia√ß√µes e impactos."| Q["‚úèÔ∏è Otimiza√ß√£o de Prompts"]
    end

    %% Novos M√≥dulos Adicionados
    subgraph "üîé Monitoramento"
        R["üìä Dashboard"] -->|"IA: Detec√ß√£o de anomalias (ex: queda repentina no recall). Alertas autom√°ticos."| S["üö® Sistema de Alertas"]
    end

    %% Conex√µes Adicionais
    E -->|Backup| R
    I -->|Monitoramento| R
    M -->|Logs| R

    %% Estiliza√ß√£o
    classDef preprocess fill:#f0f9ff,stroke:#1e40af,stroke-width:2px;
    classDef knowledge fill:#e0f2fe,stroke:#1e40af,stroke-width:2px;
    classDef rag fill:#dbeafe,stroke:#1e3a8a,stroke-width:2px;
    classDef eval fill:#fef9c3,stroke:#ca8a04,stroke-width:2px;
    classDef monitor fill:#ffedd5,stroke:#ea580c,stroke-width:2px;

    class A,B,C,D,E preprocess;
    class F,G,H,I,J knowledge;
    class K,L,M rag;
    class N,O,P,Q eval;
    class R,S monitor;